env:
  global:
  - secure: h6vzY3/eky+GZL7Oo8SFpjZ1/Xp0zGxES7Rnc/3LSMIM2snnUYc0f06M2HoDNj1DxGV15QxzUqziGJ53mD9dg/FA97aw5b2g/84u5+zo7VX8PeC50QHndI+KWrxiXJScUKu9XM0+/cawpUS7fTEc61a1guqpVW5Ycr5ef50uYThC3KU1hQwGYHNG1Dp0aAbQQbgmPVwvHEwL86Ge5jxU0bCn5aCSL9MwryF2AeB4kwz0HtU7exmXLUQPjM9RVHFgRTjQl7J30AhUJhhXwuDD106vW9SSPRbI/SmTNHYmNjLkW16vf2eEw05hse1KOnpuSu1WMlYqN92Y1YEmaHHJXr5rjIdiz7KFgoVJVMWcsGcxsgnDaWts3wfT05tPnGZDgUqfj5B48bUJ9j8JuXBl1Cv7MKjOCfu2Jfa5Mlie39uh0V8Na5flM87TxXcX8YdBEsPq6hGBHoj8qt1FLAIv6b6UgLu4zbtdvWsU5LoUpmoe6llbVJXkHSO4f3lTQ+HoeInlykbN5Hzn7dmBPtC8bxrWsxTE+jLswAxh+vWpr3O3QRszs31A9RC1+3pv6Y92JZ1YSurfIlByGZAzXLiIjB+jqvf1kY6oRoqqBHSKpXsepctG2epZDQO9kgxy2IVcs50mHIP45oIUxdXeb4c+AW6T3/22nNIgIHIIUBs/ov4=
  - secure: jBxK5krcj5K5N5efpt24arH5yLgUpfGwLY6Amy3i41SPc32k4QOoUFqhbkU4shns4y8rIlV2o/Mmx30WJKkx+Ri+OI1ymagg68hEPM/AWa/Y6EcVaEwz+henxIrBzz9otRr3IENO7GfiIEW6bfWAjdMbrQgZuMsjqFJklPOiKdct5n93Ohm+fenCFEV1R9Z+PoSoJZ7AzCobqAuuYThSk9lwb7ukLQkaMnh7HQqOapDRlJgQBlk0Qja2vheTG4x5q03a9z1w24RspAVdZbRlG+baw9YdUx/OYsqGB5zwc4XVzApdNGX6tMa0NW/eLWNzUISHQBhXjQrJSx01May5uMOo3EqRuralUeVOcgn5CXNDKYhxSacTPSg9UzeAw9Ek0+bxufFLta0QgB5F9/9fjoDLB7/zzq/YtO0r8STxyUavODa+6XW5rKQEoT9412wfMKTreJ7oILM72HRMF0Svn68wbukhbIgBBJghf/uymy8hr1xzfVFiZYpqqulmbrSgeUKNuYBiFmIAXPh4auRuO0gGJCiziReDl9pfXrMaJj7/D95A4QQiEfoEJFcJ33P7CyfelpOJaBqicpPqh4lI9rwAo1WL97Bl4S/GkP/+RkPr3REGKdfVVRvZpPzjIOi0YJcQ+jY7Ivc9FoJnQAdZQ58Z7pXHQIzu4JhMh34MM7M=

services:
- docker

addons:
  sonarcloud:
    organization: departement-loire-atlantique
    token:
      secure: tbLCQCKmG/jUMP4w9djtd+7xEHe6seceasy6yqECSbUICmuGT0xSZd+ZSUPUgukjdk63R6qqL5zLNvyjmf4+A0RcZXBkypuDgHFW29gVBGPaBmXAq4XPgBML5kCvs/IXxiWXlX790m2dFHgZkQxDHT4HvaU6JjMwyK0GACPdlLOgogrTqer19AFUG2LqCL3bgBJKcB+sX5BqnJFTLcYWuVb6vselJm4kJuXzrrVVvEJ6YeGqFHt3+s0rSy651AivHl8g1fcHecmIuZPl9Mqwp6pa6bXVVhg3/pSD+LvLO6XRGa9qWGSYp5rGbUKgYcZmQVgl87l7BvB7vBAyB0SUfdsL7iaZ1PPR/dVZF4Lwdj7JI2BUy/efNNetMmrJ8H9FyalEKZ//JwGcumndq1+obxSb5PRRVoJjQ7lT44JYw1yAL6rY42k2o2LJ+m2IuGphD3Lc2Q3wBVFResSLT1leX29w0RfCE4Uwqo6a4NHk1+LZtQ3DmOx9F4Pw+Lm+KlpycOuHt3o7epKol8Dpoy4mCWf/FNT1NPTwx0cgO2Bs1z3fe014Ijrg3peJKM/6L0u/8DarJF6hqbw0vjjvMvyJXxLDUEWFpmckK5SZ86SA5F8QykgZkEgcZA1mgG3Ja3VrJHt42h4B/B6ByNXwQfvV8WCLzgkkeKEIqK4XZ5MDqjk=

before_script:
- echo "$DOCKER_PASS" | docker login --username $DOCKER_USER --password-stdin
- docker pull julienbayle/jplatformbuild

script:
- docker run -v ${TRAVIS_BUILD_DIR}:/root/source --name buildimage -t julienbayle/jplatformbuild
- docker cp buildimage:/root/dist .
- export CODE_VERSION=`git describe`
- sonar-scanner -Dsonar.projectVersion=$CODE_VERSION

deploy:
  provider: releases
  api_key:
    secure: YtdRH8A7pl7feuoCqBL3GaOrz8ln9M3dnVyAjxVKeRbvLjJ6kJuR8MWYnf8Ioq8etkf9toOQ6sq0XB2ps0c3hwI0SRyDbXPuSUDfeZu4Q3/XU35mwKeyFYF+nAcPO7wKLpIKZJDtT1/GwMjDVTOTP8viLWKqdlCk2enCf4HRm6Ui2NeXx8OC/lqbiCDiwAa5hoBOwaPT4DH1lZ6FhvE/4IutEtI60o2NdssqUF9oL5Ua96IB9NJFuOTshuAJbI19JrneEf9Gx2EUm4Yj3n86UWedntrJZDsnkmVANSwK1lQUwg8z9rLLOV91zdNK4NZJtNkHBLEmemvQOBjLeiM8o1OZddtSR53AF3C1wG66zLsxpB7w8IyESZZkhyGQw1zMKNRJls9Aus/8851oS9NkCJXH0oUlJEOqsBZLxixQwxQx4Gnf/VxyQAkuQKoS2tBJVLhXdujlChiBXPCyCCTUP4A6vtrs9I7wyGH83zMzhlMF7hdWPS8xmMXxWZrDHpEtvDXHXAzz2QvDUeZYCNZVhWYynZcHGkxEULJpZJl1S/i6CMUlcPUwxLk8jvJKkWn6dwv/gEiW+ocIVtlvuEouFqMugvZyzQmu+C07H13/vSn9idI9kv5/+Jbbphw1MLDn+C25lWWLHTHUUTysFwOSQPP51hhp62nDHO8VbzTRCmg=
  file_glob: true
  file: "${TRAVIS_BUILD_DIR}/dist/*.zip"
  skip_cleanup: true
  on:
    tags: true
