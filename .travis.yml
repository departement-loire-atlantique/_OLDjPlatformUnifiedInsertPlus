env:
  global:
  - secure: Vre+k4OWu4wGqlZtKee3K0rVlTnmL6VklFECOLyrUz+6otlD8FzPQSIGlsKv26pE9YnwFNsZSWSGzSwpjmr6/cOuFD6sV3yycEjkK/J+RjxrjXYEQ7HHFYngu2jpOU4kLS7/nWck8av9o0Txea9qgrm2dDAN4rQPQ29SvYuZ5Z0601mTUF8R3Os1+HE0T5/Xfxg6oWBi7OSmiO58Wr6xf0IDbtKpegCdorNMfUFfNkrHQiyfPCofZfONpDoQyWVoWKvktFhvhrNu94yveInrQpS9LVltvGjjWWuIFcino8nGCmq4mlzpxJdtZ1ueXJbtoTrJx4g+TGUVGFgT0uqkw4rxGwYt2IALwOuw3gV3Mx/6eo71izYuGhhfjniOtjQn+LuDtbNHWvwumeibKLtueWIRsW+s2nLoPbR2TBL24Pqjk2RJOhWxQsS6zV6ipOuXaI+zlnDUYj0ZUGH0emE6+ZpMoIrleqnk5cvj1X+h58RHPJS1NNpcXIj9/QSPR+sylR4zAIJVhAwYK5/TeTFQCFDZ4WkwVpxC6rDLlavvE0/Kam3UU9ZdEgE0lzVvgYKEjv/GBAo6hKraNzInBGYKfrEY7ElE0rqkCtsG0Pjpdb7KmVEdgd0x53NwP+6q7wa6+us4O+HgDH/wbyoYkQtd24crSFJxOMOuwAnzehKO6N8=
  - secure: SgUOKic4fNU3Y1tIINDWSJ2nN9KlUrGLy5FXFvI9ij1+S2+nBMGKV/ux1Kxtf9LSmQ/1esRO/D0kmTgad8pgHrThkna7QeywlOFMibiVI/mgqpoSKS6CPloViWWC6qCsAO5FRcPhqDrrhlr2h/L6n3jWlSDfAraWCDs91BSHQUpSUWtVHvppOu9vMLy58di2T0B6f1Nfasoyb9AvlK3DZbx5l2EpIzg21x2NYRZII87IN5moGxF4v9aHxi+nluSWg3FEHcDrKw2vnU8wd8d5iW900ZTWnpLIcKvwOcs8VOr2iHwTHVtXfkFBbskcnm8wbmFGn2+qOu022ZGkfOxJgf1lnV3d93ETD7GxbnBQTz8UPmZbSmoOsAfMSlW3zivQ3cj8utMGT5cf0GmSpMf1pRt49t6SFoAxSCkuJ++dDMu+bZrUHlB44b9RJHW5Uh/5A7qL9SOuGcRk4H2kMDKDlIuDiWhOUjhZ0t7b9NaDQWgnig6Lx4Qbdbj44JjEqIf8nukuTiw2OwfUwt6FW5AE9XZEoq1ExXFW1Oz6ANPem6TZJmfeXBg+rXJqCMuiOZ0Fg5fcEdUaDF9kj7un4uizWbuLJ3LgCYRUmGdrSMPUL+OLDK4PnYz+pbM5hjxnSrJoPTfHHmSH0vRUoJmGktBX8KUccSc1tIYt+ppIA92fmcM=

services:
- docker

addons:
  sonarcloud:
    organization: departement-loire-atlantique
    token:
      secure: LlboIUDhx+4rrXSy1l539Cy+xY2gUK4JHD6u3O0W3XHXF85WpkGWLtBwFe3KNb7Rg6B44l2X0cjQEPMMttKymwsd970XNESwUmVCAOCNRL706eZGV9J5sy5MDhSX22QwTZankl3tAbBS3RPRfcGmUT98jcQiL9BYRLivl3iW5Dwvd3rrghic4X9cYcvZSs6vzbzJxUvhWOCuouCoM/vEX9FezOWe2/6oqVuxK+yasSwW6F/C19o9Me6gzjYGBTEMz+m3s95OqQV1mE9mHuf3HRpE1aUqVBrZsKh+yeSIREwda67yK+lCjNSFU0ZfZBAI86cib7/cXIkq12xdbqGLPGTMalkcc62vDnMyaVQylL7xGcGK7peDpNX/sonYXGxTiKZ1P9GsxB17aIZldxIF3xd9mGpHdW1/gbtpHQ5+XrPlTspiiZHDNZjGVVUCfJ326MA7Q1IUIGAkZXIRTF/QDs9/fBo3PFKhv8Eb59BWcuihiUxTt2Kk9ThpeyLhm4wyahyyc7mL5GhmBO8EtTeiP/jHR46Zt68WLdRN9+TAhWvW/LVyu0dAFYDoD3UguD0ybgCSfjgWueKgHbfsQ6FUCfE9fofQgKBmSVt5OI67CpR7yJaSxVbV+/Eb6uhZfIXcEgAq8O1xURA4Xpg9R4NJfwBqmHVcC93QeBOCJUVsmyk=

before_script:
- echo "$DOCKER_PASS" | docker login --username $DOCKER_USER --password-stdin
- docker pull julienbayle/jplatformbuild

script:
- docker run -v ${TRAVIS_BUILD_DIR}:/root/source --name buildimage -t julienbayle/jplatformbuild
- docker cp buildimage:/root/dist .
- export CODE_VERSION=`git describe`
- sonar-scanner -Dsonar.projectVersion=$CODE_VERSION

deploy:
  provider: releases
  api_key:
    secure: iuOWVD2Qy5qhjFruMXGSFg/KHQKEPudJzYZTBqwueyY1x8U64dlxAE/aTgypmdwJRQNWveWZTRAmhcjLPNPdrEIoX7+MCwOj0a6Ar9uOVDdCQaE9aa26pDYKFGsf0BT4NBLcMf90J1Iw0lHI/A5ubiBrVISQBpQA0dNjTwoQsISa9I3+xTrJKjfYULMvUWq+DlVQJrlNY0SizrmxILrAwXYT/U2YOWpVyXIOpCjNbRtmDyLyZFuLdgum5E8+5iOzu8mLyNk2ajb3T5reX5eWJ0bSdbR0cMEg7MrzIltTtilPSJeVdnB3gYzXx71LixPNOiHyIVjBV645FD3ceuJQY8mLqGsDb/euMpiyQeh+mSdqdmEe1Sza95d2xoPy+VdZfFTZUHdrJ3U9vxOsP8YQ93OXANgJu3BW/87pcLulJc01Eg0VfUyiQfkJJ/sM2h4ZKObBAY/49Upt40jRBqebvUsf97WmORUc4/TbzfXDDlJ/nxdKXCqSTl7ObkytRKO0ZRkbLh4y9melFpu8ZTwrajV9lsVC1oWj8bRoBJDHvoWhBeWDI72jCrcteVC8Divy4/iYcDRxNIxR3qFLxKMAUzYAirshrPDL+v1SIIrLz8kTy/ZZwCcmA9dSRoMaiMUxYzDl4TPn3F3OE4p7HbBi7OHUtRspJvBTcqQ1sNZTlCc=
  file_glob: true
  file: "${TRAVIS_BUILD_DIR}/dist/*.zip"
  skip_cleanup: true
  on:
    tags: true
